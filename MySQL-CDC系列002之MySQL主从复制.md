# 一 MySQL主从复制

## 1.1 相关概念

### 1.1.1 MySQL复制

​		将一个MySQL的数据库服务器中的数据复制到一个或者多个MySQL数据库服务器中

### 1.1.2 MySQL复制分类

​		(1) 主从复制: 单个主库,多个从库

​		(2) 链式复制: 主库 ---> 中继主库 ---> 从库

​		(3) 主主复制: 主库之间可以相关接受写入和复制

​		(4) 多元复制: 一个从库的数据是从多个主库中复制而来的

### 1.1.2 MySQL主从复制

​		MySQL主从复制将主数据库中的DDL和DML操作通过二进制日志binlog传输到从数据库上，然后将这些日志重新执行（重做）；从而使得从数据库的数据与主数据库保持一致。

## 1.2 主从复制的作用

​		(1) 主数据库出现问题，可以切换到从数据库。

​		(2) 可以进行数据库层面的读写分离，

​		(3) 可以在从数据库上进行日常备份

## 1.3 主从复制的过程

​		MySQL主从复制的过程如图所示:

![MySQL复制示意图](../MySQL-CDC/MySQL-CDC002/MySQL主从复制.png)

​		Binary log：主数据库的二进制日志;       Relay log：从服务器的中继日志

​		MYSQL主从同步是异步复制的过程，整个同步需要开启3线程: 

​		1） master上开启bin-log日志（记录数据库增、删除、修改、更新操作）；
​		2） Slave开启I/O线程来请求master服务器，请求指定bin-log中position点之后的内容；
​		3） Master端收到请求，Master端I/O线程响应请求，bin-log、position之后内容返给salve；
​		4） Slave将收到的内容存入relay-log中继日志中，生成master.info（记录master ip、bin-log、position、用户名密码）；
​		5） Slave端SQL实时监测relay-log日志有更新，解析更新的sql内容，解析成sql语句，再salve库中执行；
​		6） 执行完毕之后，Slave端跟master端数据保持一致！

# 二 CDC

## 2.1 基本概念

​		CDC 的全称是 **Change Data Capture** ，在广义的概念上，只要是能捕获数据变更的技术，我们都可以称之为 CDC 。目前通常描述的 CDC 技术主要面向数据库的变更，是一种用于捕获数据库中数据变更的技术。CDC 技术的应用场景非常广泛：

- **数据同步**: 用于容灾和备份
- **数据分发**: 一个数据源分发给多个下游系统
- **数据采集**: 在面向数据分析的数据仓库/数据湖时, 是十分重要的数据源.

## 2.2 分类

### 2.2.1 按实现机制进行分类		

​		CDC 的技术方案非常多，目前业界主流的实现机制可以分为两种：

- **基于查询的 CDC：**
  - 离线调度查询作业，批处理。把一张表同步到其他系统，每次通过查询去获取表中最新的数据；
  - 无法保障数据一致性，查的过程中有可能数据已经发生了多次变更；
  - 不保障实时性，基于离线调度存在天然的延迟。

- **基于日志的 CDC：**
  - 实时消费日志，流处理，例如 MySQL 的 binlog 日志完整记录了数据库中的变更，可以把 binlog 文件当作流的数据源；
  - 保障数据一致性，因为 binlog 文件包含了所有历史变更明细；
  - 保障实时性，因为类似 binlog 的日志文件是可以流式消费的，提供的是实时数据。

### 2.2.2 按具体方式进行分类

​		按照具体的方式, 可大致分为两种四类: 

- **侵入式CDC:** 

  所谓侵入式, 就是需要在源库中执行SQL语句.

  - **基于时间戳的CDC**

    查询出源数据库中最新的数据, 再流转到下游. 这种方式最为简单.

  - **基于触发器的CDC**

    是关系数据库系统具有的特性，源表上建立的触发器会在对该表执行insert、update、delete等语句时被触发，触发器中的逻辑用于捕获数据的变化

  - **基于快照的CDC**

    使用固定时刻产生的快照. 可以使用数据库系统自带的机制实现，如Oracle的物化视图技术，也可以自己实现相关逻辑，但会比较复杂

- **非侵入式CDC:**

  - **基于日志的CDC**

    使用源数据库的日志，这种方式对源数据库不具有侵入性，但需要额外的日志解析工作.